# streamlit run CoQ.py
import streamlit as st
import re
import time

# --- é¢„è®¾ç¤ºä¾‹ï¼šé—®é¢˜é“¾ä¸ç­”æ¡ˆï¼ˆå¯æŒ‰éœ€ä¿®æ”¹ï¼‰ ---
EXAMPLE_QUESTIONS = """
å­¦ç§‘ï¼šé«˜ä¸­è¯­æ–‡  
æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼šè¯¾æ–‡ã€Šè·å¡˜æœˆè‰²ã€‹

---

**ä¸€ã€é“¾å¼é—®é¢˜**

1. ä½ è®¤ä¸ºã€Šè·å¡˜æœˆè‰²ã€‹è¿™ç¯‡æ•£æ–‡çš„åŸºæœ¬ä½“è£ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä¸è®°å™æ–‡æˆ–è®®è®ºæ–‡ç›¸æ¯”ï¼Œæœ‰å“ªäº›æ˜æ˜¾ä¸åŒï¼Ÿï¼ˆç®€ç­”é¢˜ï¼ŒåŸºç¡€ï¼‰

2. ä½œè€…åœ¨æ–‡ä¸­å¤šæ¬¡æå†™â€œè·å¡˜â€çš„æ™¯ä¸â€œæœˆè‰²â€çš„å…‰ï¼Œä½ èƒ½æ‰¾å‡ºè‡³å°‘ä¸¤å¤„å…·ä½“æ™¯ç‰©æå†™ï¼Œå¹¶è¯´è¯´è¿™äº›æå†™åœ¨æƒ…æ„Ÿè¡¨è¾¾ä¸Šçš„ä½œç”¨å—ï¼Ÿï¼ˆç®€ç­”é¢˜ï¼ŒåŸºç¡€ï¼‰

3. æ–‡ä¸­æœ‰â€œè¿™å‡ å¤©å¿ƒé‡Œé¢‡ä¸å®é™â€ä»¥åŠå¯¹â€œç¤¾ä¼šç°å®â€çš„éšçº¦æåŠï¼Œä½ è®¤ä¸ºä½œè€…ä¸ºä»€ä¹ˆè¦ç”¨å®¡ç¾åŒ–çš„è·å¡˜æ™¯è‰²æ¥å¯¹åº”è¿™ç§å†…å¿ƒçš„ä¸å®é™ï¼Ÿè¿™å½¢æˆäº†æ€æ ·çš„ä¸€ç§â€œå¯¹ç…§å…³ç³»â€ï¼Ÿï¼ˆè®ºè¿°é¢˜ï¼Œä¸­æ¡£ï¼‰

4. å¦‚æœæŠŠå…¨æ–‡çœ‹ä½œâ€œç°å®â€”æƒ³è±¡â€”å›åˆ°ç°å®â€çš„ç»“æ„ï¼Œä½ èƒ½å°è¯•æ¢³ç†è¿™ä¸€ç»“æ„åœ¨æ–‡ä¸­çš„å…·ä½“ä½“ç°å—ï¼Ÿå¹¶è¯´æ˜è¿™ç§ç»“æ„å¯¹è¯»è€…ç†è§£ä½œè€…æƒ…æ„Ÿæœ‰ä»€ä¹ˆå¸®åŠ©ã€‚ï¼ˆç»“æ„åˆ†æé¢˜ï¼Œä¸­æ¡£ï¼‰

5. å‡å¦‚ä½ æ˜¯è¯­æ–‡è€å¸ˆï¼Œè¦ä»¥ã€Šè·å¡˜æœˆè‰²ã€‹ä¸ºè½½ä½“è®¾è®¡ä¸€æ¬¡â€œå®¡ç¾ä½“éªŒä¸ç°å®å…³æ€€â€çš„è¯¾å ‚æ´»åŠ¨ï¼Œä½ ä¼šå¦‚ä½•è®©å­¦ç”Ÿä»â€œæ™¯ç‰©æå†™â€å‡ºå‘ï¼Œè¿‡æ¸¡åˆ°å¯¹ç°å®ç”Ÿæ´»å’Œè‡ªæˆ‘å†…å¿ƒçš„æ€è€ƒï¼Ÿè¯·ç»™å‡ºä¸€ä¸ªç®€è¦çš„æ•™å­¦ç¯èŠ‚è®¾è®¡æ€è·¯ã€‚ï¼ˆæ•™å­¦è®¾è®¡é¢˜ï¼Œæé«˜ï¼‰

6. ç»“åˆä½ è¯»è¿‡çš„å…¶ä»–æŠ’æƒ…æ•£æ–‡æˆ–ç°ä»£è¯—æ­Œï¼ˆå¦‚ã€Šå†åˆ«åº·æ¡¥ã€‹ã€Šé›¨å··ã€‹ç­‰ï¼‰ï¼Œè°ˆè°ˆã€Šè·å¡˜æœˆè‰²ã€‹åœ¨â€œä»¥æ™¯å¯„æƒ…ã€æ‰˜ç‰©è¨€å¿—â€æ–¹é¢æœ‰å“ªäº›ç‹¬ç‰¹ä¹‹å¤„ï¼Ÿä½ æ˜¯å¦å¯ä»¥æç‚¼å‡ºä¸€æ¡é€‚ç”¨äºç°ä»£æ•£æ–‡é˜…è¯»çš„â€œå®¡ç¾é˜…è¯»å°ç­–ç•¥â€ï¼Ÿï¼ˆå¼€æ”¾æ€§è®ºè¿°é¢˜ï¼Œæé«˜ï¼‰

---

å…³è”é€»è¾‘è¯´æ˜ï¼š  
é—®é¢˜1èšç„¦æ–‡æœ¬ä½“è£å’Œæ–‡ç±»ç‰¹ç‚¹ï¼Œæ„å»ºå¯¹â€œæ•£æ–‡â€”æŠ’æƒ…æ•£æ–‡â€çš„åŸºç¡€è®¤çŸ¥ï¼›  
é—®é¢˜2åœ¨æ­¤åŸºç¡€ä¸Šå°†æ³¨æ„åŠ›èšç„¦åˆ°å…·ä½“æ™¯ç‰©æå†™ï¼Œå¸®åŠ©å­¦ç”Ÿä½“ä¼šâ€œä»¥æ™¯å¯“æƒ…â€çš„åŸºæœ¬æŠ€æ³•ï¼›  
é—®é¢˜3æŠŠâ€œæ™¯â€ä¸â€œå¿ƒâ€çš„å…³ç³»æ˜¾æ€§åŒ–ï¼Œå¼•å¯¼å­¦ç”Ÿè®¤è¯†åˆ°è·å¡˜æ™¯è‰²èƒŒåæœ‰å¯¹ç°å®çš„ä¸å®‰ä¸åæ€ï¼Œå®Œæˆä»æ„Ÿæ€§æå†™åˆ°æƒ…æ„Ÿå†…æ¶µçš„è¿‡æ¸¡ï¼›  
é—®é¢˜4è¦æ±‚å­¦ç”Ÿä»æ•´ä½“ç»“æ„ä¸ŠæŠŠæ¡æ–‡ç« ï¼Œç†è§£â€œç°å®â€”æƒ³è±¡â€”ç°å®â€çš„å¾€å¤ï¼Œæ¨åŠ¨ä»å±€éƒ¨æ„Ÿå—ä¸Šå‡åˆ°æ•´ä½“å®¡ç¾ä½“éªŒï¼›  
é—®é¢˜5åˆ™æŠŠè¿™ç§å®¡ç¾ç†è§£è¿ç§»åˆ°çœŸå®æ•™å­¦æƒ…å¢ƒï¼Œå¼•å¯¼å­¦ç”Ÿï¼ˆæˆ–å‡†æ•™å¸ˆï¼‰æ€è€ƒå¦‚ä½•å°†æ–‡æœ¬ä»·å€¼è½¬åŒ–ä¸ºè¯¾å ‚æ´»åŠ¨ï¼Œå±äºâ€œåº”ç”¨è¿ç§»â€”è¯¾å ‚å®è·µâ€çš„å±‚é¢ï¼›  
é—®é¢˜6è¿›ä¸€æ­¥æ‹“å±•åˆ°è·¨æ–‡æœ¬æ¯”è¾ƒä¸é˜…è¯»æ–¹æ³•æç‚¼ï¼Œæ¨åŠ¨å­¦ç”Ÿåœ¨æ›´å¤§èŒƒå›´çš„æ–‡å­¦é˜…è¯»ä¸­å½¢æˆâ€œå®¡ç¾ç­–ç•¥â€ï¼Œå®ç°â€œç»¼åˆåˆ›æ–°â€çš„é«˜é˜¶æ€ç»´ç›®æ ‡ã€‚
"""

EXAMPLE_ANSWERS = """
1. å…³äºä½“è£ç‰¹ç‚¹ï¼ˆç®€ç­”é¢˜ï¼ŒåŸºç¡€ï¼‰  
ã€Šè·å¡˜æœˆè‰²ã€‹æ˜¯ä¸€ç¯‡æŠ’æƒ…æ•£æ–‡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š  
- **ä»¥æŠ’æƒ…ä¸ºä¸»**ï¼šé€šè¿‡å¯¹è·å¡˜å¤œè‰²çš„æå†™è¡¨è¾¾å¤æ‚è€Œç»†è…»çš„æƒ…æ„Ÿï¼Œè€Œéå•çº¯å™äº‹ã€‚  
- **é‡åœ¨æ„å¢ƒè¥é€ **ï¼šå¤§é‡è¿ç”¨æ¯”å–»ã€æ‹Ÿäººã€é€šæ„Ÿç­‰ä¿®è¾ï¼Œæ„æˆæŸ”å’Œã€æœ¦èƒ§ã€å¹½é™çš„å®¡ç¾æ„å¢ƒã€‚  
- **ç»“æ„æ¾æ•£è€Œæƒ…æ„Ÿè´¯é€š**ï¼šç¯‡ç« ä¹‹é—´ä¸åƒè®®è®ºæ–‡é‚£æ ·ä¸¥æ ¼è®ºè¯ï¼Œè€Œæ˜¯é¡ºç€ä½œè€…æ¼«æ­¥è·å¡˜ã€è”æƒ³ç°å®çš„å¿ƒç†æµåŠ¨å±•å¼€ã€‚  
ä¸ä¸€èˆ¬è®°å™æ–‡ç›¸æ¯”ï¼Œå®ƒä¸ä»¥â€œäº‹ä»¶å‘å±•â€ä¸ºæ ¸å¿ƒï¼›ä¸è®®è®ºæ–‡ç›¸æ¯”ï¼Œå®ƒä¸ä»¥â€œè§‚ç‚¹â€”è®ºæ®â€”è®ºè¯â€ä¸ºéª¨å¹²ï¼Œè€Œæ˜¯ä»¥æƒ…æ„Ÿçº¿ç´¢ä¸æ„å¢ƒçº¿ç´¢è´¯ç©¿å…¨æ–‡ã€‚

---

2. æ™¯ç‰©æå†™åŠä½œç”¨ï¼ˆç®€ç­”é¢˜ï¼ŒåŸºç¡€ï¼‰  
ç¤ºä¾‹ä¸€ï¼šå¦‚â€œå±‚å±‚çš„å¶å­ä¸­é—´ï¼Œé›¶æ˜Ÿåœ°ç‚¹ç¼€ç€äº›ç™½èŠ±ï¼Œæœ‰è¢…å¨œåœ°å¼€ç€çš„ï¼Œæœ‰ç¾æ¶©åœ°æ‰“ç€æœµå„¿çš„â€¦â€¦â€  
- **ä½œç”¨**ï¼šé€šè¿‡åŠ¨æ€è¯å’Œæ‹ŸäººåŒ–çš„å½¢å®¹è¯ï¼ˆâ€œè¢…å¨œâ€â€œç¾æ¶©â€ï¼‰ï¼Œèµ‹äºˆè·èŠ±ä»¥äººæ ¼åŒ–æ°”è´¨ï¼Œè¥é€ æ¸©æŸ”ã€å«è“„çš„å®¡ç¾æ°›å›´ï¼Œå¼±åŒ–ç°å®å‹åŠ›çš„æ²‰é‡æ„Ÿã€‚

ç¤ºä¾‹äºŒï¼šå¦‚â€œæœˆå…‰å¦‚æµæ°´ä¸€èˆ¬ï¼Œé™é™åœ°æ³»åœ¨è¿™ä¸€ç‰‡å¶å­å’ŒèŠ±ä¸Šâ€¦â€¦â€  
- **ä½œç”¨**ï¼šæŠŠæœˆå…‰æ¯”ä½œâ€œæµæ°´â€ï¼Œæ—¢æœ‰æµåŠ¨æ„Ÿï¼Œåˆæœ‰æ´—æ¶¤æ„Ÿï¼Œæš—ç¤ºä½œè€…è¯•å›¾è®©å¿ƒçµåœ¨æœˆè‰²ä¸­â€œå†²æ·¡â€ç°å®çƒ¦å¿§ï¼Œä½“ç°æ™¯ç‰©å¯¹å¿ƒçµçš„æŠšæ…°ä½œç”¨ã€‚

æ•´ä½“è€Œè¨€ï¼Œè¿™äº›æ™¯ç‰©æå†™åœ¨æƒ…æ„Ÿä¸Šèµ·åˆ°**æŸ”åŒ–ç°å®ã€å®‰é¡¿å¿ƒçµã€è¥é€ é™ç¾æ„å¢ƒ**çš„æ•ˆæœï¼Œä¸ºåæ–‡è½¬å…¥å¯¹ç°å®çš„ä¸å®‰å’Œæ€è€ƒåšäº†é“ºå«ã€‚

---

3. â€œä¸å®é™â€ä¸è·å¡˜æ™¯è‰²çš„å¯¹ç…§å…³ç³»ï¼ˆè®ºè¿°é¢˜ï¼Œä¸­æ¡£ï¼‰  
- æ–‡é¦–â€œè¿™å‡ å¤©å¿ƒé‡Œé¢‡ä¸å®é™â€ï¼Œç‚¹å‡ºä½œè€…å¯¹ç°å®ç¤¾ä¼šç¯å¢ƒã€ä¸ªäººå¤„å¢ƒçš„å‹æŠ‘æ„Ÿä¸ä¸å®‰æƒ…ç»ªã€‚  
- è·å¡˜ä¸æœˆè‰²åˆ™å‘ˆç°å‡ºä¸€ç§**é™è°§ã€æ´å‡€ã€è¶…è„±å°˜åš£**çš„å®¡ç¾ç©ºé—´ã€‚  
- äºŒè€…æ„æˆé²œæ˜å¯¹ç…§ï¼š  
  - **ç°å®ä¸–ç•Œ**ï¼šå˜ˆæ‚ã€é»‘æš—ã€å‹æŠ‘ï¼›  
  - **è·å¡˜ä¸–ç•Œ**ï¼šå®é™ã€æ¸…é›…ã€å¯Œæœ‰è¯—æ„ã€‚  
- ä½œè€…é€šè¿‡â€œèµ°åˆ°è·å¡˜è¾¹â€â€œåœ¨æœˆè‰²ä¸‹æ¼«æ­¥â€çš„åŠ¨ä½œï¼ŒæŠŠè‡ªå·±æš‚æ—¶ä»ç°å®ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œå€ŸåŠ©è·å¡˜æ™¯è‰²æ¥å®‰æŠšå†…å¿ƒï¼Œä»¥å®¡ç¾çš„æ–¹å¼å¯¹æŠ—ç°å®çš„æ²‰é‡ã€‚  
è¿™ç§å¯¹ç…§å…³ç³»ï¼Œä½¿è¯»è€…æ„è¯†åˆ°ï¼šçœ‹ä¼¼å•çº¯çš„æ™¯ç‰©æå†™ï¼ŒèƒŒåæœ‰æ·±å±‚çš„ç°å®å…³æ€€ä¸ç²¾ç¥è¯‰æ±‚ï¼Œä½“ç°äº†â€œå€Ÿæ™¯ä»¥åè§‚ç°å®â€çš„å†™æ³•ã€‚

---

4. â€œç°å®â€”æƒ³è±¡â€”å›åˆ°ç°å®â€çš„ç»“æ„åˆ†æï¼ˆç»“æ„åˆ†æé¢˜ï¼Œä¸­æ¡£ï¼‰  
å¯å¤§è‡´æ¢³ç†ä¸ºï¼š  
1. **ç°å®å¼€ç«¯**ï¼šå¤œæ·±äººé™ã€å¿ƒé‡Œâ€œä¸å®é™â€ï¼Œèµ°å‡ºå®¶é—¨åˆ°è·å¡˜æ•£æ­¥ï¼ˆç°å®æƒ…å¢ƒï¼‰ã€‚  
2. **å®¡ç¾æƒ³è±¡/å¿ƒçµæ¸¸å†é˜¶æ®µ**ï¼š  
   - å¯¹è·å¡˜ã€æœˆè‰²ã€è·å¶ã€è·èŠ±çš„ç»†è‡´æå†™ï¼›  
   - æ€ç»ªåœ¨å¤œè‰²ä¸­èˆ’å±•ï¼Œä»¿ä½›è¿›å…¥ä¸ç°å®éš”ç¦»çš„â€œæ¡ƒæºâ€èˆ¬ç©ºé—´ã€‚  
3. **å›åˆ°ç°å®ä¸éšå¿§**ï¼š  
   - å®¡ç¾ä½“éªŒéš¾ä»¥çœŸæ­£æ¶ˆé™¤ç°å®å‹åŠ›ï¼›  
   - æ–‡ç« ç»“å°¾ä»å¸¦æœ‰æ·¡æ·¡çš„å¿§éƒä¸æ— å¥ˆã€‚

è¿™ç§ç»“æ„çš„æ„ä¹‰åœ¨äºï¼š  
- è®©è¯»è€…è·Ÿéšä½œè€…ï¼Œä¸€èµ·å®Œæˆä»ç°å®çƒ¦å¿§ â†’ å®¡ç¾æš‚é¿ â†’ å†å›åˆ°ç°å®çš„å¿ƒç†æ—…ç¨‹ï¼›  
- ä½¿æ–‡ç« æ—¢æœ‰è¶…ç„¶çš„ç¾æ„Ÿï¼Œåˆä¸å¤±å¯¹ç°å®çš„æ¸…é†’æ„ŸçŸ¥ï¼Œä»è€Œå½¢æˆä¸€ç§â€œæ¸…é†’çš„è¯—æ„â€ã€‚

---

5. æ•™å­¦æ´»åŠ¨è®¾è®¡æ€è·¯ç¤ºä¾‹ï¼ˆæ•™å­¦è®¾è®¡é¢˜ï¼Œæé«˜ï¼‰  
æ•™å­¦ç›®æ ‡æ–¹å‘ï¼š  
- è®©å­¦ç”Ÿåœ¨å®¡ç¾ä½“éªŒä¸­ä½“ä¼šâ€œä»¥æ™¯å¯„æƒ…â€ï¼›  
- å¼•å¯¼å­¦ç”ŸæŠŠå¯¹æ–‡æœ¬æ„å¢ƒçš„æ„Ÿå—è¿ç§»åˆ°å¯¹ç°å®ç”Ÿæ´»å’Œè‡ªæˆ‘å†…å¿ƒçš„æ€è€ƒã€‚

ç®€è¦ç¯èŠ‚ç¤ºä¾‹ï¼š  
1. **å¯¼å…¥ï¼šè§†è§‰+éŸ³ä¹åˆ›è®¾æƒ…å¢ƒ**  
   - æ’­æ”¾è·å¡˜ã€æœˆè‰²ç›¸å…³çš„å›¾ç‰‡æˆ–çŸ­è§†é¢‘ï¼Œé…åˆè½»éŸ³ä¹ï¼Œè®©å­¦ç”Ÿè¿›è¡Œâ€œç¬¬ä¸€å°è±¡â€è‡ªç”±è”æƒ³ã€‚  

2. **ç»†è¯»ï¼šåœˆç‚¹å‹¾ç”»æ™¯ç‰©æå†™**  
   - åˆ†ç»„ä»»åŠ¡ï¼šæ¯ç»„è´Ÿè´£ä¸€æ®µæ™¯ç‰©æå†™ï¼Œåœˆå‡ºå…³é”®è¯ï¼ˆåŠ¨è¯ã€å½¢å®¹è¯ã€ä¿®è¾ï¼‰ï¼Œç”¨è‡ªå·±çš„è¯è¯´â€œè¿™å¹…ç”»é¢æ˜¯ä»€ä¹ˆæ„Ÿè§‰â€ã€‚  

3. **è¿‡æ¸¡ï¼šä»â€œç”»é¢â€åˆ°â€œå¿ƒæƒ…â€**  
   - é—®ï¼šå¦‚æœä½œè€…åªæƒ³å†™â€œæ™¯è‰²å¾ˆç¾â€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å†™â€œå¿ƒé‡Œé¢‡ä¸å®é™â€ï¼Ÿ  
   - å¼•å¯¼å­¦ç”Ÿæ€è€ƒï¼šè¿™äº›ç¾æ™¯æ˜¯åœ¨â€œä»€ä¹ˆæ ·çš„å¿ƒæƒ…â€ä¸­è¢«çœ‹è§çš„ï¼Ÿ  

4. **æ‹“å±•ï¼šè”ç³»ç°å®ä¸è‡ªæˆ‘**  
   - å°ç»„è®¨è®ºï¼šâ€œå½“ä½ æ„Ÿåˆ°å‹åŠ›æˆ–çƒ¦æ¼æ—¶ï¼Œæ˜¯å¦ä¹Ÿä¼šç”¨æŸç§æ–¹å¼ï¼ˆä¾‹å¦‚æ•£æ­¥ã€å¬æ­Œã€ç”»ç”»ï¼‰æ¥è®©è‡ªå·±å¹³é™ï¼Ÿè¿™ä¸ä½ æ‰€è¯»åˆ°çš„ã€Šè·å¡˜æœˆè‰²ã€‹æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿâ€  
   - åˆ†äº«äº¤æµï¼Œå¹¶é¼“åŠ±å­¦ç”Ÿå†™ä¸€å°æ®µæ–‡å­—ï¼Œå°è¯•æ¨¡ä»¿æ–‡ä¸­â€œä»¥æ™¯å†™å¿ƒâ€çš„æ–¹å¼è¡¨è¾¾è‡ªå·±çš„æ„Ÿå—ã€‚

é€šè¿‡ä»¥ä¸Šç¯èŠ‚ï¼Œå®Œæˆä»â€œæ™¯ç‰©æå†™â€â†’â€œæƒ…æ„Ÿç†è§£â€â†’â€œç°å®å…³ç…§ä¸è‡ªæˆ‘è¡¨è¾¾â€çš„é€’è¿›ã€‚

---

6. è·¨æ–‡æœ¬æ¯”è¾ƒä¸å®¡ç¾ç­–ç•¥æç‚¼ï¼ˆå¼€æ”¾æ€§è®ºè¿°é¢˜ï¼Œæé«˜ï¼‰  
ä¸ã€Šå†åˆ«åº·æ¡¥ã€‹ã€Šé›¨å··ã€‹ç­‰ä½œå“æ¯”è¾ƒï¼š  
- éƒ½æœ‰æ˜æ˜¾çš„â€œæ„å¢ƒç¾â€ï¼Œé‡è§†èŠ‚å¥æ„Ÿä¸ç”»é¢æ„Ÿï¼›  
- éƒ½é€šè¿‡æ™¯ç‰©æˆ–æ„è±¡ï¼ˆåº·æ¡¥çš„æ°´è‰ã€é›¨å··çš„ä¸é¦™å§‘å¨˜ç­‰ï¼‰æ¥æ‰¿è½½å¤æ‚æƒ…æ„Ÿã€‚  

ã€Šè·å¡˜æœˆè‰²ã€‹çš„ç‹¬ç‰¹ä¹‹å¤„ï¼š  
- è¯­è¨€æ›´æ¥è¿‘ç™½è¯æ•£æ–‡ï¼Œä½†åœ¨èŠ‚å¥æ§åˆ¶ã€è¯­å¥é•¿çŸ­å˜åŒ–ä¸Šæå…·éŸ³ä¹æ€§ï¼›  
- â€œç°å®â€”å®¡ç¾â€”ç°å®â€çš„ç»“æ„æ›´ä¸ºæ¸…æ™°ï¼Œç°å®æ„Ÿæ›´æµ“ï¼›  
- è·å¡˜æ„è±¡æ—¢æœ‰ä¼ ç»Ÿæ–‡åŒ–ä¸­çš„æ¸…é«˜ã€æ´å‡€ä¹‹æ„ï¼Œåˆå åŠ äº†æ—¶ä»£èƒŒæ™¯ä¸‹çš„å¿§éƒä¸ä¸å®‰ã€‚

å¯æç‚¼çš„ä¸€æ¡â€œå®¡ç¾é˜…è¯»å°ç­–ç•¥â€ç¤ºä¾‹ï¼š  
> **å…ˆè¯»ç”»é¢ï¼Œå†é—®æƒ…æ„Ÿï¼Œæœ€åè”ç³»ç°å®ã€‚**  
å³ï¼š  
1. å…ˆæŠŠæ–‡æœ¬çœ‹æˆä¸€å¹…ç”»ï¼Œå¼„æ¸…â€œçœ‹è§äº†ä»€ä¹ˆâ€ï¼›  
2. å†è¿½é—®â€œè¿™æ ·å†™æ™¯æƒ³è¡¨è¾¾æ€æ ·çš„å¿ƒæƒ…æˆ–æ€åº¦â€ï¼›  
3. æœ€åæ€è€ƒâ€œè¿™ç§å¿ƒæƒ…ä¸å½“æ—¶çš„æ—¶ä»£ã€ä½œè€…çš„å¤„å¢ƒæˆ–æˆ‘ä»¬çš„ç°å®ç”Ÿæ´»æœ‰ä»€ä¹ˆå…³è”â€ã€‚  

é€šè¿‡è¿™æ¡ç­–ç•¥ï¼Œå­¦ç”Ÿåœ¨é˜…è¯»å…¶ä»–æŠ’æƒ…æ•£æ–‡æˆ–è¯—æ­Œæ—¶ï¼Œä¹Ÿèƒ½æ›´æœ‰æ„è¯†åœ°åœ¨â€œæ™¯â€”æƒ…â€”æ„â€ä¹‹é—´æ¥å›ç©¿æ¢­ï¼Œæå‡å®¡ç¾ä¸æ€è¾¨èƒ½åŠ›ã€‚
"""

# === æµå¼è¾“å‡ºæ¨¡æ‹Ÿå‡½æ•° ===
def simulate_streaming(text: str, placeholder, delay: float = 0.01, chunk_size: int = 8):
    """
    å°†ç»™å®šæ–‡æœ¬ä»¥â€œæµå¼â€çš„æ–¹å¼è¾“å‡ºåˆ° placeholderã€‚
    - delay: æ¯æ¬¡æ›´æ–°ä¹‹é—´çš„å»¶æ—¶ï¼ˆç§’ï¼‰
    - chunk_size: æ¯æ¬¡è¿½åŠ çš„å­—ç¬¦æ•°
    """
    displayed = ""
    # å»æ‰å¼€å¤´å¤šä½™çš„æ¢è¡Œï¼Œé¿å…ä¸€å¼€å§‹ç©ºç™½å¤ªå¤§
    text = text.lstrip("\n")
    for i in range(0, len(text), chunk_size):
        displayed += text[i:i+chunk_size]
        placeholder.markdown(displayed)
        time.sleep(delay)

# --- é¡µé¢é…ç½® ---
st.set_page_config(page_title="é“¾å¼é—®é¢˜ç”Ÿæˆå™¨", page_icon="ğŸ”—", layout="wide")

# --- åº”ç”¨æ ‡é¢˜å’Œè¯´æ˜ ---
st.title("ğŸ”— é€šç”¨å­¦ç§‘é—®é¢˜é“¾ç”Ÿæˆ")
st.markdown("""
> å½“å‰ä¸º **ç¤ºä¾‹ç«™ç‚¹**ï¼š  
> - ä¸è°ƒç”¨ä»»ä½•å¤§æ¨¡å‹ APIï¼›  
> - é€šè¿‡æœ¬åœ°å­—ç¬¦ä¸² + `time.sleep` **æ¨¡æ‹Ÿæµå¼è¾“å‡ºæ•ˆæœ**ã€‚  
> å·¦ä¾§è¾“å…¥å­¦ç§‘ä¸æè¿°ä»…ç”¨äºå±•ç¤ºï¼Œä¸å½±å“ç¤ºä¾‹å†…å®¹ã€‚
""")

# --- ä¾§è¾¹æ ï¼šç”¨æˆ·è¾“å…¥ ---
with st.sidebar:
    st.header("ç”¨æˆ·é…ç½®åŒºï¼ˆç¤ºä¾‹ï¼‰")

    subject = st.text_input(
        "è¯·è¾“å…¥å­¦ç§‘",
        value="é«˜ä¸­è¯­æ–‡",
        help="ç¤ºä¾‹ç‰ˆä¸­ï¼Œè¯¥è¾“å…¥ä»…ç”¨äºå±•ç¤ºï¼Œä¸å‚ä¸å®é™…ç”Ÿæˆ"
    )
    core_knowledge = st.text_input(
        "è¯·æè¿°æ‚¨æƒ³è¦ç”Ÿæˆçš„é—®é¢˜",
        value="è¯·ç”Ÿæˆé«˜ä¸­è¯¾æ–‡ã€Šè·å¡˜æœˆè‰²ã€‹çš„ç›¸å…³è¯¾ç¨‹é—®é¢˜",
        help="ç¤ºä¾‹ç‰ˆä¸­ï¼Œè¯¥è¾“å…¥ä»…ç”¨äºå±•ç¤ºï¼Œä¸å‚ä¸å®é™…ç”Ÿæˆ"
    )

    generate_button = st.button("ç”Ÿæˆé—®é¢˜é“¾ï¼ˆæ¨¡æ‹Ÿæµå¼ï¼‰", type="primary")

# --- ä¸»ç•Œé¢å†…å®¹æ¸²æŸ“ï¼ˆç¤ºä¾‹é€»è¾‘ï¼‰ ---
if generate_button:
    # éªŒè¯è¾“å…¥ï¼ˆä¿ç•™ä¸€ç‚¹çœŸå®äº¤äº’æ„Ÿï¼‰
    if not subject or not core_knowledge:
        st.warning("å­¦ç§‘å’Œæ ¸å¿ƒçŸ¥è¯†ç‚¹å‡ä¸ºå¿…å¡«é¡¹ï¼ˆç¤ºä¾‹ç‰ˆåŒæ ·è¦æ±‚è¾“å…¥å®Œæ•´ï¼‰ã€‚")
    else:
        # æ¸…ç©ºä¹‹å‰çš„ä¼šè¯çŠ¶æ€
        for key in ['raw_response', 'answers_response']:
            if key in st.session_state:
                del st.session_state[key]

        st.info("å½“å‰ä¸ºç¤ºä¾‹ç«™ç‚¹ï¼Œå°†ä»¥â€œæµå¼â€æ–¹å¼å±•ç¤ºé¢„è®¾å¥½çš„ã€Šè·å¡˜æœˆè‰²ã€‹é—®é¢˜é“¾ç¤ºä¾‹ã€‚")

        # ç”¨ placeholder æ¨¡æ‹Ÿæµå¼è¾“å‡º
        response_placeholder = st.empty()
        simulate_streaming(EXAMPLE_QUESTIONS, response_placeholder, delay=0.01, chunk_size=10)

        # å°†å®Œæ•´å†…å®¹å­˜å…¥ session_stateï¼Œæ–¹ä¾¿åˆ·æ–°åæŸ¥çœ‹
        st.session_state['raw_response'] = EXAMPLE_QUESTIONS
        st.success("ç¤ºä¾‹é—®é¢˜é“¾æµå¼å±•ç¤ºå®Œæˆï¼")

        # è§£æå¹¶å±•ç¤ºå…³è”é€»è¾‘è¯´æ˜ï¼ˆå•ç‹¬æŠ˜å ï¼‰
        try:
            if "å…³è”é€»è¾‘è¯´æ˜ï¼š" in EXAMPLE_QUESTIONS:
                parts = re.split(r'å…³è”é€»è¾‘è¯´æ˜ï¼š', EXAMPLE_QUESTIONS, maxsplit=1)
                logic_part = "å…³è”é€»è¾‘è¯´æ˜ï¼š" + parts[1]
                with st.expander("æŸ¥çœ‹å…³è”é€»è¾‘è¯´æ˜"):
                    st.markdown(logic_part)
        except Exception as e:
            st.warning(f"è§£æå…³è”é€»è¾‘è¯´æ˜æ—¶å‡ºé”™: {e}")

        st.markdown("---")
        st.info("è‹¥æƒ³æŸ¥çœ‹æ¨¡æ‹Ÿçš„ç­”æ¡ˆæµå¼è¾“å‡ºï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼ˆæˆ–åˆ·æ–°åç‚¹å‡»é¡µé¢ä¸‹æ–¹çš„æŒ‰é’®ï¼‰ã€‚")

# æ˜¾ç¤ºå·²ç”Ÿæˆçš„é—®é¢˜ï¼ˆåˆ·æ–°åï¼Œä»èƒ½çœ‹åˆ°ï¼‰
elif 'raw_response' in st.session_state and 'answers_response' not in st.session_state:
    st.markdown(st.session_state['raw_response'])

    try:
        if "å…³è”é€»è¾‘è¯´æ˜ï¼š" in st.session_state['raw_response']:
            parts = re.split(r'å…³è”é€»è¾‘è¯´æ˜ï¼š', st.session_state['raw_response'], maxsplit=1)
            logic_part = "å…³è”é€»è¾‘è¯´æ˜ï¼š" + parts[1]
            with st.expander("æŸ¥çœ‹å…³è”é€»è¾‘è¯´æ˜"):
                st.markdown(logic_part)
    except:
        pass

# ========= ç­”æ¡ˆç”Ÿæˆï¼ˆç¤ºä¾‹æµå¼ï¼‰ =========
st.markdown("---")
generate_answer = st.button("ç”Ÿæˆç­”æ¡ˆ", type="secondary")

if generate_answer and 'raw_response' in st.session_state:
    st.info("å½“å‰ä¸ºç¤ºä¾‹ç«™ç‚¹ï¼Œå°†ä»¥â€œæµå¼â€æ–¹å¼å±•ç¤ºé¢„è®¾å¥½çš„ç­”æ¡ˆç¤ºä¾‹ã€‚")

    answer_placeholder = st.empty()
    simulate_streaming(EXAMPLE_ANSWERS, answer_placeholder, delay=0.01, chunk_size=12)

    st.session_state['answers_response'] = EXAMPLE_ANSWERS
    st.success("ç¤ºä¾‹ç­”æ¡ˆæµå¼å±•ç¤ºå®Œæˆï¼")

# æ˜¾ç¤ºå·²ç”Ÿæˆçš„ç­”æ¡ˆï¼ˆåˆ·æ–°åç»§ç»­çœ‹ï¼‰
if 'answers_response' in st.session_state:
    st.markdown("---")
    st.subheader("ğŸ“ é—®é¢˜ç­”æ¡ˆï¼ˆç¤ºä¾‹ï¼Œå®Œæ•´å†…å®¹ï¼‰")
    st.markdown(st.session_state['answers_response'])

# --- é¡µè„š ---
st.markdown("---")
st.markdown("""
å½“å‰ç‰ˆæœ¬è¯´æ˜ï¼š  
1. **ä¸è°ƒç”¨ä»»ä½• OpenRouter æˆ–å¤§è¯­è¨€æ¨¡å‹ API**ï¼Œæ‰€æœ‰å†…å®¹å‡ä¸ºé¢„è®¾ç¤ºä¾‹ã€‚  
2. é€šè¿‡ `simulate_streaming` + `st.empty()` æ¨¡æ‹Ÿâ€œToken é€æ­¥åˆ·å‡ºæ¥â€çš„æ•ˆæœã€‚  
3. å¦‚éœ€æ¥å…¥çœŸå®æ¨¡å‹ï¼Œåªéœ€ï¼š  
   - ç”¨çœŸå®çš„æµå¼å“åº”æ›¿æ¢ `simulate_streaming` çš„è°ƒç”¨ï¼›  
   - å°†æ¨¡å‹è¿”å›çš„å†…å®¹ç´¯ç§¯åˆ°å­—ç¬¦ä¸² `displayed` å¹¶ `placeholder.markdown(displayed)` å³å¯å¤ç”¨åŒæ ·çš„å‰ç«¯é€»è¾‘ã€‚  
4. å¦‚éœ€å¢åŠ å¤šå¥—ç¤ºä¾‹ï¼ˆä¸åŒå­¦ç§‘/è¯¾æ–‡ï¼‰ï¼Œå¯ä»¥åœ¨é¡¶éƒ¨å†å®šä¹‰å¤šä¸ª `EXAMPLE_XXX`ï¼Œç„¶åæ ¹æ®è¾“å…¥å…³é”®è¯ç®€å• `if`/`elif` é€‰æ‹©å¯¹åº”ç¤ºä¾‹å³å¯ã€‚
""")
